{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
  <link rel="stylesheet" href="{% static 'css/broadcast.css' %}">
{% endblock %}

{% block content %}
  <div class="broadcast-card" id="broadcast-card">
    <div class="card-body">
      <h1 class="broadcast-title">üì£ {% trans "–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞" %}</h1>

      <form id="broadcast-form" method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="form-row">
          <label class="field-label" for="{{ form.media_type.id_for_label }}">{{ form.media_type.label }}</label>
          {{ form.media_type }}
        </div>

        {# ‚¨á‚¨á‚¨á –î–û–ë–ê–í–õ–ï–ù–û: –ø–æ–ª–µ —Ñ–∞–π–ª–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–æ #}
        <div class="form-row" id="file-row" style="display:none;">
          <label class="field-label" for="{{ form.file.id_for_label }}">{{ form.file.label }}</label>
          {{ form.file }}
          <p class="field-help">{% trans "–§–æ—Ç–æ/–≤–∏–¥–µ–æ/–≥–∏—Ñ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞" %}</p>
        </div>

        <div class="form-row">
          <label class="field-label" for="{{ form.text.id_for_label }}">{{ form.text.label }}</label>
          {{ form.text }}
        </div>

        <div class="form-row">
          <label class="field-label" for="{{ form.buttons.id_for_label }}">{{ form.buttons.label }}</label>
          {{ form.buttons }}
          {% if form.buttons.help_text %}
            <p class="field-help">{{ form.buttons.help_text|linebreaksbr }}</p>
          {% endif %}
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary">{% trans "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" %}</button>
          <a href="{% url 'admin:users_telegramuser_changelist' %}" class="btn">{% trans "–û—Ç–º–µ–Ω–∞" %}</a>
        </div>
      </form>
    </div>
  </div>

  {# ‚¨á‚¨á‚¨á –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ accept #}
  <script>
    (function () {
      const typeSel = document.getElementById('id_media_type');
      const fileRow = document.getElementById('file-row');
      const fileInp = document.getElementById('id_file');

      if (!typeSel || !fileRow || !fileInp) return;

      function applyVisibility() {
        const t = typeSel.value;               // text | photo | video | animation
        const needsFile = t !== 'text';
        fileRow.style.display = needsFile ? '' : 'none';
        fileInp.required = needsFile;

        if (t === 'photo') {
          fileInp.accept = 'image/*';
        } else if (t === 'video') {
          fileInp.accept = 'video/*';
        } else if (t === 'animation') {
          fileInp.accept = 'image/gif, video/*';
        } else {
          fileInp.removeAttribute('accept');
        }
      }

      typeSel.addEventListener('change', applyVisibility);
      document.addEventListener('DOMContentLoaded', applyVisibility);
      applyVisibility();
    })();
  </script>
{% endblock %}